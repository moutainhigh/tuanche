<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="message.messageDao" >

  <resultMap id="BaseResultMap" type="com.taisf.services.message.entity.MessageEntity" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="subject" property="subject" jdbcType="VARCHAR" />
    <result column="title" property="title" jdbcType="VARCHAR" />
    <result column="content" property="content" jdbcType="VARCHAR" />
    <result column="send_time" property="sendTime" jdbcType="TIMESTAMP" />
    <result column="link_type" property="linkType" jdbcType="INTEGER" />
    <result column="url" property="url" jdbcType="VARCHAR" />
    <result column="receive_user" property="receiveUser" jdbcType="VARCHAR" />
    <result column="send_type" property="sendType" jdbcType="INTEGER" />
    <result column="send_user_name" property="sendUserName" jdbcType="VARCHAR" />
    <result column="send_user_id" property="sendUserId" jdbcType="INTEGER" />
    <result column="send_scope" property="sendScope" jdbcType="INTEGER" />
    <result column="timing_send" property="timingSend" jdbcType="INTEGER" />
    <result column="platform" property="platform" jdbcType="INTEGER" />
    <result column="img_url" property="imgUrl" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="INTEGER" />
  </resultMap>


  <sql id="Base_Column_List" >
    id, subject, title, content, send_time, link_type, url, receive_user, send_type,send_user_id,send_user_name,send_scope,timing_send,platform,img_url,state
  </sql>


  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from t_message
    where id = #{id,jdbcType=INTEGER}
  </select>


  <select id="getMessageByDate" resultType="java.lang.Integer" parameterType="java.util.Map" >
    select
    count(1)
    from t_message
    where 1=1
    <if test="platform != null " >
      and (platform = 0 or platform = #{platform,jdbcType=INTEGER})
    </if>
    <if test="lastTime != null" >
      <![CDATA[
    AND send_time >= #{lastTime,jdbcType=TIMESTAMP} ]]>
    </if>
    <if test="msgType != null and subject != ''" >
      AND  subject = #{msgType,jdbcType=VARCHAR}
    </if>
    and state = 1
    and send_scope = 1
  </select>


  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from t_message
    where id = #{id,jdbcType=INTEGER}
  </delete>


  <insert id="insertSelective" useGeneratedKeys="true" keyProperty="" parameterType="com.taisf.services.message.entity.MessageEntity" >
    insert into t_message
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="subject != null" >
        subject,
      </if>
      <if test="title != null" >
        title,
      </if>
      <if test="content != null" >
        content,
      </if>
      <if test="sendTime != null" >
        send_time,
      </if>
      <if test="linkType != null" >
        link_type,
      </if>
      <if test="url != null" >
        url,
      </if>
      <if test="receiveUser != null" >
        receive_user,
      </if>
      <if test="sendType != null" >
        send_type,
      </if>
      <if test="sendUserName != null" >
        send_user_name,
      </if>
      <if test="sendUserId != null" >
        send_user_id,
      </if>
      <if test="sendScope != null" >
        send_scope,
      </if>
      <if test="timingSend != null" >
        timing_send,
      </if>
      <if test="platform != null" >
        platform,
      </if>
      <if test="imgUrl != null" >
        img_url,
      </if>
      <if test="state != null" >
        state,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="subject != null" >
        #{subject,jdbcType=VARCHAR},
      </if>
      <if test="title != null" >
        #{title,jdbcType=VARCHAR},
      </if>
      <if test="content != null" >
        #{content,jdbcType=VARCHAR},
      </if>
      <if test="sendTime != null" >
        #{sendTime,jdbcType=TIMESTAMP},
      </if>
      <if test="linkType != null" >
        #{linkType,jdbcType=INTEGER},
      </if>
      <if test="url != null" >
        #{url,jdbcType=VARCHAR},
      </if>
      <if test="receiveUser != null" >
        #{receiveUser,jdbcType=VARCHAR},
      </if>
      <if test="sendType != null" >
        #{sendType,jdbcType=INTEGER},
      </if>
      <if test="sendUserName != null" >
        #{sendUserName,jdbcType=VARCHAR},
      </if>
      <if test="sendUserId != null" >
        #{sendUserId,jdbcType=INTEGER},
      </if>
      <if test="sendScope != null" >
        #{sendScope,jdbcType=INTEGER},
      </if>
      <if test="timingSend != null" >
        #{timingSend,jdbcType=INTEGER},
      </if>
      <if test="platform != null" >
        #{platform,jdbcType=INTEGER},
      </if>
      <if test="imgUrl != null" >
        #{imgUrl,jdbcType=VARCHAR},
      </if>
      <if test="state != null" >
        #{state,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>


  <update id="updateByPrimaryKeySelective" parameterType="com.taisf.services.message.entity.MessageEntity" >
    update t_message
    <set >
      <if test="subject != null" >
        subject = #{subject,jdbcType=VARCHAR},
      </if>
      <if test="title != null" >
        title = #{title,jdbcType=VARCHAR},
      </if>
      <if test="content != null" >
        content = #{content,jdbcType=VARCHAR},
      </if>
      <if test="sendTime != null" >
        send_time = #{sendTime,jdbcType=TIMESTAMP},
      </if>
      <if test="linkType != null" >
        link_type = #{linkType,jdbcType=INTEGER},
      </if>
      <if test="url != null" >
        url = #{url,jdbcType=VARCHAR},
      </if>
      <if test="receiveUser != null" >
        receive_user = #{receiveUser,jdbcType=VARCHAR},
      </if>
      <if test="sendType != null" >
        send_type = #{sendType,jdbcType=INTEGER},
      </if>

      <if test="timingSend != null" >
        timing_send = #{timingSend,jdbcType=INTEGER},
      </if>
      <if test="platform != null" >
        platform = #{platform,jdbcType=INTEGER},
      </if>
      <if test="imgUrl != null" >
        img_url = #{imgUrl,jdbcType=VARCHAR},
      </if>
      <if test="state != null" >
        state = #{state,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>


  <update id="updateByPrimaryKey" parameterType="com.taisf.services.message.entity.MessageEntity" >
    update t_message
    set subject = #{subject,jdbcType=VARCHAR},
      title = #{title,jdbcType=VARCHAR},
      content = #{content,jdbcType=VARCHAR},
      send_time = #{sendTime,jdbcType=TIMESTAMP},
      link_type = #{linkType,jdbcType=INTEGER},
      url = #{url,jdbcType=VARCHAR},
      receive_user = #{receiveUser,jdbcType=VARCHAR},
      send_type = #{sendType,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>

  <select id="findMessagePageList" resultMap="BaseResultMap" parameterType="com.taisf.services.message.dto.MessageRequest" >
    select
    <include refid="Base_Column_List" />
    from t_message
    where 1=1
    <if test="title != null and title != ''" >
      AND  title LIKE concat('%',#{title},'%')
    </if>
    <if test="subject != null and subject != ''" >
      AND  subject = #{subject,jdbcType=VARCHAR}
    </if>
    <if test="platform != null and sendType != ''" >
      AND  platform = #{platform,jdbcType=INTEGER}
    </if>
    <if test="startTime != null and startTime != ''" >
      <![CDATA[
    AND  send_time >= #{startTime}
       ]]>
    </if>
    <if test="endTime != null and endTime != ''" >
      <![CDATA[
    AND  send_time <= #{endTime}
      ]]>
    </if>
    ORDER BY send_time DESC
  </select>

  <select id="findMessageList" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from t_message
    where
    <![CDATA[
     NOW() >=send_time
    ]]>
    AND state = 0
  </select>


  <select id="getMsgList" resultMap="BaseResultMap" parameterType="com.taisf.services.message.dto.MsgReq">
    select
    <include refid="Base_Column_List" />
    from t_message
    where
    <![CDATA[
     send_time >= #{lastTime,jdbcType=TIMESTAMP}
     and send_time <= #{now,jdbcType=TIMESTAMP}
    ]]>
    <if test="platform != null" >
    and (platform = #{platform,jdbcType=INTEGER} or platform = 0)
    </if>
    <if test="msgType != null" >
    and subject = #{msgType,jdbcType=INTEGER}
    </if>
    AND state = 1 order by send_time desc
    <if test="limit != null" >
      limit #{limit,jdbcType=INTEGER}
    </if>
  </select>



</mapper>